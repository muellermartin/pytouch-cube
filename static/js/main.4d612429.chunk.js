(this["webpackJsonppytouch3-web"]=this["webpackJsonppytouch3-web"]||[]).push([[0],{150:function(e,t,n){},152:function(e,t,n){},161:function(e,t,n){"use strict";n.r(t);var c=n(0),a=n.n(c),o=n(53),r=n.n(o),i=(n(150),n(28)),s=n(13),l=n(14),j=n(10),d=n.n(j),u=n(131),b=(n(152),n(153),n(181)),h=n(162),O=[0,0,0,255],f=[255,255,255,255],x=function(e,t,n){"undefined"===typeof t&&(t=128);for(var c=e.getImageData(0,0,e.canvas.width,e.canvas.height),a=0;a<c.data.length;a+=4){var o=c.data[a+3]>t,r=(c.data[a]+c.data[a+1]+c.data[a+2])/3,i=o&&r>t!==!n?O:f;c.data[a+0]=i[0],c.data[a+1]=i[1],c.data[a+2]=i[2],c.data[a+3]=i[3]}e.putImageData(c,0,0)},g=n(4),v=function(e){return Object(g.jsx)(g.Fragment,{children:Object(g.jsx)(b.a,{children:Object(g.jsxs)(b.a.Field,{children:[Object(g.jsx)("label",{children:"Image:"}),Object(g.jsx)(h.a,{content:"Browse..."})]})})})},p=function(e){var t=e.threshold,n=e.inverted,a=e.image,o=Object(c.useState)(200),r=Object(s.a)(o,2),i=r[0],l=r[1],j=Object(c.useState)(!1),d=Object(s.a)(j,2),u=d[0],b=d[1],h=Object(c.useRef)(null),O=Object(c.useRef)(null);return Object(c.useEffect)((function(){var e,c=null===(e=O.current)||void 0===e?void 0:e.getContext("2d");if(c&&h.current&&u){var a=h.current.width,o=h.current.height;c.imageSmoothingEnabled=!1,c.clearRect(0,0,c.canvas.width,c.canvas.height);var r=a*(68/o);if(r!==i)return c.canvas.width=r,c.canvas.height=68,c.clearRect(0,0,c.canvas.width,c.canvas.height),void l(r);c.drawImage(h.current,0,0,r,68),i<=0||x(c,t,n)}}),[O,i,a,t,n,u]),Object(c.useEffect)((function(){b(!1)}),[a]),Object(g.jsxs)(g.Fragment,{children:[Object(g.jsx)("img",{ref:h,src:a,style:{display:"none"},alt:"",onLoad:function(){return b(!0)}}),Object(g.jsx)("canvas",{ref:O,style:{imageRendering:"pixelated",height:"140px"}})]})},m=n(17),y=n(180),w=n(177),B=n(183),k=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.map((function(e){return{key:e,value:e,text:e[0].toUpperCase()+e.substring(1)}}))},F=function(e){var t=e.text,n=e.font,a=e.threshold,o=e.inverted,r=Object(c.useState)(200),i=Object(s.a)(r,2),l=i[0],j=i[1],d=Object(c.useRef)(null);return Object(c.useEffect)((function(){var e,c=null===(e=d.current)||void 0===e?void 0:e.getContext("2d");if(c){c.imageSmoothingEnabled=!1;try{if(!document.fonts.check(n))return}catch(u){return}c.clearRect(0,0,c.canvas.width,c.canvas.height),c.font=n;var r=c.measureText(t);if(l!==r.width)return console.log(r.width,"!=",l),c.canvas.width=r.width,c.canvas.height=68,c.clearRect(0,0,c.canvas.width,c.canvas.height),void j(r.width);var i=r.fontBoundingBoxAscent+r.fontBoundingBoxDescent+r.fontBoundingBoxDescent,s=(c.canvas.height-i)/2;c.fillText(t,0,s+r.actualBoundingBoxAscent+r.fontBoundingBoxDescent,l),l<=0||(x(c,a,o),c.moveTo(0,s),c.lineTo(l,s),c.moveTo(0,s+r.fontBoundingBoxDescent),c.lineTo(l,s+r.fontBoundingBoxDescent),c.moveTo(0,s+r.fontBoundingBoxAscent+r.fontBoundingBoxDescent),c.lineTo(l,s+r.fontBoundingBoxAscent+r.fontBoundingBoxDescent),c.moveTo(0,s+i),c.lineTo(l,s+i),c.strokeStyle="red",c.stroke())}}),[d,l,t,n,a,o]),Object(g.jsx)("canvas",{ref:d,style:{imageRendering:"pixelated",height:"140px"}})},S=function(e){var t=e.item,n=e.setItem,a=Object(c.useState)("Hello!"),o=Object(s.a)(a,2),r=o[0],i=o[1],j=Object(c.useState)("otsutome_font"),d=Object(s.a)(j,2),u=d[0],h=d[1],O=Object(c.useState)(40),f=Object(s.a)(O,2),x=f[0],v=f[1];Object(c.useEffect)((function(){var e=t.font.split(" "),n=Object(s.a)(e,2),c=n[0],a=n[1];h(a);var o=/([0-9]+)(.*)/.exec(c);if(o){var r=parseInt(o[1]);v(r)}}),[t.font]),Object(c.useEffect)((function(){var e="".concat(x,"px ").concat(u);t.font!==e&&n(Object(l.a)(Object(l.a)({},t),{},{font:e}))}),[u,x,t,n]);var p=Object(c.useMemo)((function(){var e=new Set(Array.from(document.fonts.entries()).map((function(e){var t=Object(s.a)(e,2),n=t[0];t[1];return n.family}))),t=["otsutome_font"].concat(Object(m.a)(e)).sort((function(e,t){return n=e.toLowerCase(),c=t.toLowerCase(),n<c?-1:n>c?1:0;var n,c}));return k.apply(void 0,Object(m.a)(t))}),[]),F=Object(c.useMemo)((function(){return"".concat(x,"px ").concat(u)}),[u,x]);return Object(g.jsx)(g.Fragment,{children:Object(g.jsxs)(b.a,{style:{minWidth:"400px"},children:[Object(g.jsxs)(b.a.Group,{widths:"equal",children:[Object(g.jsxs)(b.a.Field,{children:[Object(g.jsx)("label",{children:"Font"}),Object(g.jsx)(y.a,{selection:!0,search:!0,value:u,options:p})]}),Object(g.jsxs)(b.a.Field,{width:"6",children:[Object(g.jsx)("label",{children:"Size"}),Object(g.jsx)(w.a,{type:"number",value:x,onKeyDownCapture:function(e){"ArrowUp"===e.key?v((function(e){return e+1})):"ArrowDown"===e.key?v((function(e){return e-1})):console.log(e.key)},onWheel:function(e){console.log(e.deltaY,e.deltaMode),v((function(t){return t+(e.deltaY<0?1:-1)}))},labelPosition:"right",label:"px"})]})]}),Object(g.jsx)(B.a,{content:Object(g.jsx)("code",{children:F}),header:"Font string:"}),Object(g.jsxs)(b.a.Field,{children:[Object(g.jsx)("label",{children:"Text"}),Object(g.jsx)(w.a,{type:"text",value:r,onChange:function(e){return i(e.target.value)}})]})]})})},I=n(188),C=function(e){var t,n=e.item,c=e.setItem;return Object(g.jsxs)(b.a,{children:[Object(g.jsx)(b.a.Field,{children:Object(g.jsx)(I.a,{toggle:!0,checked:n.inverted,label:"Inverted",onChange:function(e,t){return c(Object(l.a)(Object(l.a)({},n),{},{inverted:!!t.checked}))}})}),Object(g.jsx)(b.a.Field,{children:Object(g.jsx)(I.a,{toggle:!0,checked:n.rotated,label:"Rotated"})}),Object(g.jsxs)(b.a.Field,{children:[Object(g.jsx)("label",{children:"Flipped:"}),Object(g.jsx)(b.a.Group,{widths:"equal",children:Object(g.jsxs)(b.a.Field,{children:[Object(g.jsx)(I.a,{toggle:!0,checked:n.flippedHorizontal,label:"Horizontal"}),Object(g.jsx)(b.a.Field,{}),Object(g.jsx)(I.a,{toggle:!0,checked:n.flippedVertical,label:"Vertical"})]})})]}),Object(g.jsxs)(b.a.Field,{children:[Object(g.jsx)("label",{children:"Threshold"}),Object(g.jsx)(w.a,{type:"range",min:"0",max:"254",value:null!==(t=n.threshold)&&void 0!==t?t:128,onChange:function(e,t){return c(Object(l.a)(Object(l.a)({},n),{},{threshold:parseInt(t.value,10)}))}})]})]})},T=n(178),D=n(182),E=n(185),R=n(186),L=n(179),A={marginTop:0,marginBottom:0,marginLeft:0,marginRight:0},P=[Object(l.a)({key:"t1",type:"text",text:"Hello?",font:"40px otsutome_font"},A),Object(l.a)({key:"t2",type:"text",text:"Text with space",font:"40px otsutome_font"},A),Object(l.a)({key:"i1",type:"image",image:"/shoutrrr.png"},A),Object(l.a)({key:"t3",type:"text",text:"Wow!!",font:"40px otsutome_font"},A)];var V=function(){var e,t=Object(u.a)(),n=t.register,a=t.handleSubmit,o=t.formState.errors,r=Object(c.useState)(),j=Object(s.a)(r,2),O=j[0],f=j[1],x=Object(c.useState)(),m=Object(s.a)(x,2),w=m[0],B=m[1];Object(c.useEffect)((function(){Object.values(o).every((function(e){return!e}))}),[o]);var I=Object(c.useState)(P),A=Object(s.a)(I,2),V=A[0],H=A[1],_=function(e){console.log("Connected!",e.target)},q=function(e){console.log("Disconnected!",e.target)};Object(c.useEffect)((function(){if(O)return O.addEventListener("connect",_),O.addEventListener("disconnect",q),function(){O.removeEventListener("connect",_),O.removeEventListener("disconnect",q)}}),[O]);var z=function(){var e=Object(i.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),M=function(){var e=Object(i.a)(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.serial.requestPort();case 3:return n=e.sent,console.log("Port:",Object(l.a)({},n)),console.log("Info:",n.getInfo()),f(n),e.next=9,n.open({baudRate:t.baudRate});case 9:console.log("Port connected(?)!"),console.log("Info:",n.getInfo()),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(0),console.error(e.t0),B({title:"Error connecting web serial",message:null===e.t0||void 0===e.t0?void 0:e.t0.message});case 17:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t){return e.apply(this,arguments)}}(),U=Object(c.useState)(null),G=Object(s.a)(U,2),W=G[0],J=G[1],N=function(e){return H((function(t){return t.map((function(t){return t.key===e.key?e:t}))}))};return Object(g.jsx)("div",{className:"App",children:Object(g.jsxs)(T.a,{children:[Object(g.jsxs)(D.a,{fluid:!0,children:[Object(g.jsxs)(D.a.Header,{style:{padding:"10px"},children:[Object(g.jsx)(h.a,{floated:"right",color:"violet",size:"tiny",onClick:function(){return z()},children:"Update Ports"}),Object(g.jsx)(E.a,{floated:"left",children:"Printer communication"})]}),Object(g.jsx)(D.a.Content,{children:Object(g.jsxs)(b.a,{onSubmit:a(M),children:[Object(g.jsxs)(b.a.Group,{widths:"equal",children:[Object(g.jsxs)(b.a.Field,{children:[Object(g.jsx)("label",{children:"Baud Rate:"}),Object(g.jsx)(y.a,Object(l.a)({selection:!0,options:k("75","110","300","1200","2400","4800","9600","19200","38400","57600","115200"),defaultValue:"9600"},n("baudRate")))]}),Object(g.jsxs)(b.a.Field,{children:[Object(g.jsx)("label",{children:"Data Bits:"}),Object(g.jsx)(y.a,Object(l.a)({selection:!0,options:k("5","6","7","8","9"),defaultValue:"8"},n("dataBits")))]}),Object(g.jsxs)(b.a.Field,{children:[Object(g.jsx)("label",{children:"Flow control:"}),Object(g.jsx)(y.a,Object(l.a)({selection:!0,options:k("none","hardware"),defaultValue:"none"},n("flowControl")))]}),Object(g.jsxs)(b.a.Field,{children:[Object(g.jsx)("label",{children:"Parity:"}),Object(g.jsx)(y.a,Object(l.a)({clearable:!0,selection:!0,options:k("none","odd","even","mark","space"),defaultValue:""},n("parity")))]}),Object(g.jsxs)(b.a.Field,{children:[Object(g.jsx)("label",{children:"Stop Bits:"}),Object(g.jsx)(y.a,Object(l.a)({clearable:!0,selection:!0,options:k("1","1.5","2"),defaultValue:""},n("stopBits")))]})]}),Object(g.jsx)(h.a,{type:"submit",content:"Connect"})]})})]}),Object(g.jsxs)(R.a,{children:[Object(g.jsx)(E.a,{children:"Label editor"}),w&&Object(g.jsxs)("dialog",{children:[Object(g.jsx)("header",{children:w.title}),Object(g.jsx)("div",{children:null!==(e=w.message)&&void 0!==e?e:"Unknown error"})]}),Object(g.jsx)("div",{style:{display:"flex",flexDirection:"row",alignItems:"flex-start"},children:V.map((function(e){return Object(g.jsxs)(L.a,{on:"click",position:"bottom center",onOpen:function(){return J(e)},onClose:function(){return J(null)},trigger:Object(g.jsx)("div",{className:"label-item".concat((null===W||void 0===W?void 0:W.key)===e.key?" selected":""),children:"text"===e.type?Object(g.jsx)(F,Object(l.a)({},e)):"image"===e.type?Object(g.jsx)(p,Object(l.a)({},e)):Object(g.jsx)("div",{children:"Invalid item"})}),children:[Object(g.jsx)(C,{item:e,setItem:N}),"text"===e.type&&Object(g.jsx)(S,{item:e,setItem:N}),"image"===e.type&&Object(g.jsx)(v,{item:e,setItem:N})]},e.key)}))})]})]})})},H=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,189)).then((function(t){var n=t.getCLS,c=t.getFID,a=t.getFCP,o=t.getLCP,r=t.getTTFB;n(e),c(e),a(e),o(e),r(e)}))};r.a.render(Object(g.jsx)(a.a.StrictMode,{children:Object(g.jsx)(V,{})}),document.getElementById("root")),H()}},[[161,1,2]]]);
//# sourceMappingURL=main.4d612429.chunk.js.map